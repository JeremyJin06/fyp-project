{% extends "base.html" %}
{% block title %}Phishing Game{% endblock %}
{% block content %}
<div class="p-6 bg-white shadow-md rounded-md">
    <div id="startContainer">
        <h3 class="mb-5 text-xl font-medium text-gray-900 white:text-white">Difficulty Level</h3>
        <ul class="grid grid-flow-col gap-6 md:grid-rows-3">
            <li>
                <input type="radio" id="difficulty-beginner" name="difficultyLevel" value="beginner" class="hidden peer" required />
                <label for="difficulty-beginner" class="inline-flex items-center justify-between w-full p-5 text-gray-500 bg-white border border-gray-200 rounded-lg cursor-pointer white:hover:text-gray-300 white:border-gray-700 white:peer-checked:text-blue-500 peer-checked:border-blue-600 peer-checked:text-blue-600 hover:text-gray-600 hover:bg-gray-100 white:text-gray-400 white:bg-gray-800 white:hover:bg-gray-700">                           
                    <div class="block">
                        <div class="w-full text-lg font-semibold">Beginner</div>
                        <div class="w-full">Start from here if you are new to Phishing</div>
                    </div>
                    <svg class="w-5 h-5 ms-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5h12m0 0L9 1m4 4L9 9"/>
                    </svg>
                </label>
            </li>
            <li>
                <input type="radio" id="difficulty-intermediate" name="difficultyLevel" value="intermediate" class="hidden peer">
                <label for="difficulty-intermediate" class="inline-flex items-center justify-between w-full p-5 text-gray-500 bg-white border border-gray-200 rounded-lg cursor-pointer white:hover:text-gray-300 white:border-gray-700 white:peer-checked:text-blue-500 peer-checked:border-blue-600 peer-checked:text-blue-600 hover:text-gray-600 hover:bg-gray-100 white:text-gray-400 white:bg-gray-800 white:hover:bg-gray-700">
                    <div class="block">
                        <div class="w-full text-lg font-semibold">Intermediate</div>
                        <div class="w-full">Click here if you feel confident on your phishing knowledge</div>
                    </div>
                    <svg class="w-5 h-5 ms-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5h12m0 0L9 1m4 4L9 9"/>
                    </svg>
                </label>
            </li>
            <li>
                <input type="radio" id="difficulty-professional" name="difficultyLevel" value="professional" class="hidden peer">
                <label for="difficulty-professional" class="inline-flex items-center justify-between w-full p-5 text-gray-500 bg-white border border-gray-200 rounded-lg cursor-pointer white:hover:text-gray-300 white:border-gray-700 white:peer-checked:text-blue-500 peer-checked:border-blue-600 peer-checked:text-blue-600 hover:text-gray-600 hover:bg-gray-100 white:text-gray-400 white:bg-gray-800 white:hover:bg-gray-700">
                    <div class="block">
                        <div class="w-full text-lg font-semibold">Professional</div>
                        <div class="w-full">Go through the Professional level of the assessment </div>
                    </div>
                    <svg class="w-5 h-5 ms-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5h12m0 0L9 1m4 4L9 9"/>
                    </svg>
                </label>
            </li>
        </ul>
        <button type="button" id="startButton" class="my-10 px-10 text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Start</button>    
    </div>
    
    <form id="gameForm" method="post" style="display: none;">
        <div class="mb-4 text-xl font-semibold text-gray-900 white:text-white" id="question-container">
        <!-- Questions will be dynamically inserted here -->
        </div>
        <input type="hidden" name="score" id="score" value="0">
        <button type="submit" class="my-10 px-10 text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Check</button>        
    </form>
</div>


<div id="popup" tabindex="-1" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-50">
    <div class="relative top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md">
        <div class="bg-white rounded-lg shadow-lg">
            <button type="button" class="absolute top-3 right-3 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 inline-flex justify-center items-center" data-modal-hide="popup-modal">
            </button>
            <div class="p-4 md:p-5 text-center">                    
                <h2 class="mb-5 text-2xl font-mono text-gray-500 white:text-gray-400" id="popup-title"></h2>
                <h3 class="mb-5 text-base font-mono text-gray-500 white:text-gray-400" id="popup-message"></h3>
                <button data-modal-hide="popup-modal" type="button" class="my-10 px-10 text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800" id="popup-close">Next</button>
            </div>
        </div>
    </div>
</div>

<script>

document.getElementById('startButton').addEventListener('click', function() {
    var difficultyLevel = document.querySelector('input[name="difficultyLevel"]:checked');
    if (difficultyLevel) {
        document.getElementById('startContainer').style.display = 'none';
        document.getElementById('gameForm').style.display = 'block';
        populateQuestions(difficultyLevel.value);
    } else {
        alert('Please select a difficulty level to start the questionnaire.');
    }
});

const beginnerQuestions = [
    {
        question: "What is HTML?",
        hint: "HTML is a markup language used for creating web pages.",
        explanation: "HTML stands for HyperText Markup Language. It is the standard markup language for creating web pages.",
        answers: [
            { text: "Hypertext Markup Language", correct: true },
            { text: "Hyper Tool Multi-language", correct: false },
            { text: "Hyperlink and Text Manipulation Language", correct: false }
        ]
    },
    // Add more beginner questions here
];

const intermediateQuestions = [
    {
        question: "What is a closure in JavaScript?",
        hint: "Closures are an important concept in JavaScript.",
        explanation: "A closure is the combination of a function bundled together with references to its surrounding state.",
        answers: [
            { text: "A function that has access to its outer scope even after the outer scope has closed", correct: true },
            { text: "A function that closes the browser window", correct: false },
            { text: "A function that is used to close an open connection in a database", correct: false }
        ]
    },
    // Add more intermediate questions here
];

const professionalQuestions = [
    {
        question: "What is the concept of prototypal inheritance in JavaScript?",
        hint: "Prototypal inheritance is a core concept in JavaScript.",
        explanation: "Prototypal inheritance is the mechanism by which objects in JavaScript inherit properties and methods from other objects.",
        answers: [
            { text: "In JavaScript, objects inherit properties and methods directly from other objects, rather than from classes like in traditional inheritance.", correct: true },
            { text: "Prototypal inheritance refers to inheriting properties and methods from classes.", correct: false },
            { text: "Prototypal inheritance is not supported in JavaScript.", correct: false }
        ]
    },
    // Add more professional questions here
];

function populateQuestions(difficulty) {
    let questions;

    if (difficulty === 'beginner') {
        questions = beginnerQuestions;
    } else if (difficulty === 'intermediate') {
        questions = intermediateQuestions;
    } else if (difficulty === 'professional') {
        questions = professionalQuestions;
    }

    const questionContainer = document.getElementById('question-container');

    questions.forEach(function(question) {
        questionContainer.innerHTML += `
            <div>
                <p class="text-2xl mb-5">${question.question}</p>
                ${question.answers.map((answer, index) => `
                    <div>
                        <input type="radio" id="answer-${index}" name="answer" value="${index}">
                        <label class="text-base" for="answer-${index}">${answer.text}</label>
                    </div>
                `).join('')}
            </div>
        `;
    });
}

let wrongAnswer = false;

document.getElementById('popup-close').addEventListener('click', function() {
    document.getElementById('popup').style.display = 'none';
    if (!wrongAnswer) {
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            showQuestion(shuffledQuestions[currentQuestionIndex]);
        } else {
            document.getElementById('score').value = score;
            document.getElementById('gameForm').submit();
        }
    }
    // Reset the wrongAnswer flag
    wrongAnswer = false;
    updateButton(); // Update the button text
});

document.getElementById('gameForm').addEventListener('submit', (event) => {
    event.preventDefault();
    const selectedAnswerIndex = document.querySelector('input[name="answer"]:checked').value;
    if (questions[currentQuestionIndex].answers[selectedAnswerIndex].correct) {
        score += 10;
        showAlert("Explanation", questions[currentQuestionIndex].explanation);
        // Reset the wrongAnswer flag
        wrongAnswer = false;
    } else {
        showAlert("Hint", questions[currentQuestionIndex].hint);
        // Set the wrongAnswer flag
        wrongAnswer = true;
    }
    updateButton(); // Update the button text
});

function updateButton() {
    const button = document.getElementById('popup-close');
    if (wrongAnswer) {
        button.textContent = "Try Again";
    } else {
        button.textContent = "Next";
    }
}
        
function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {

        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }

    return array;
}

// Shuffle the questions
let shuffledQuestions = shuffle(questions);

let currentQuestionIndex = 0;
let score = 0;


function showQuestion(question) {
    const questionContainer = document.getElementById('question-container');
    questionContainer.innerHTML = `
    <div>
        <p class="text-2xl mb-5">${question.question}</p>
        ${question.answers.map((answer, index) => `
            <div>
                <input type="radio" id="answer-${index}" name="answer" value="${index}">
                <label class="text-base" for="answer-${index}">${answer.text}</label>
            </div>
        `).join('')}
    </div>
    `;
}

showQuestion(shuffledQuestions[currentQuestionIndex]);
</script>

{% endblock %}
