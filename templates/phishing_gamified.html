{% extends "base.html" %}
{% block content %}
<h1>Phishing Game</h1>
<form id="gameForm" method="post">
    <div id="question-container">
        <!-- Questions will be dynamically inserted here -->
    </div>
    <input type="hidden" name="score" id="score" value="0">
    <button type="submit">Submit Score</button>
</form>

<!-- Custom pop-up -->
<div id="popup" style="display: none; position: fixed; width: 300px; height: 200px; background: white; border: 1px solid black; padding: 10px; z-index: 1000;">
    <h2 id="popup-title"></h2>
    <p id="popup-message"></p>
    <button id="popup-close">Close</button>
</div>

<script>
    const questions = [
        {
            question: "What is the primary goal of phishing attacks?",
            hint:  "Think about what motivates attackers to create phishing campaigns.",
            explanation: "Phishers exploit social engineering techniques to trick victims into taking actions that compromise their security.",
            answers: [
                { text: "The primary goal of phishing attacks is to deceive users into revealing sensitive information (such as login credentials, credit card numbers, or personal data) by posing as a trustworthy entity.", correct: true },
                { text: "To install antivirus software on the victim’s computer.", correct: false },
                { text: "To promote legitimate products or services.", correct: false },
            ]
        },
        {
            question: "What is the purpose of a phishing email’s urgency or fear tactics?",
            hint: "Consider how emotional manipulation plays a role in phishing.",
            explanation: "By inducing panic, phishers hope victims won’t scrutinize the email’s legitimacy.",
            answers: [
                { text: "To encourage recipients to share the email with others.", correct: false },
                { text: "To promote awareness about cybersecurity risks.", correct: false },
                { text: "Urgency or fear tactics in phishing emails aim to pressure recipients into acting quickly without thinking. Attackers create a sense of emergency, such as “Your account will be suspended unless you act now!”.", correct: true }
            ]
        },
        {
            question: "What is the term for a phishing attack that targets a specific organization or industry?",
            hint: "Think about precision and customization.",
            explanation: "Unlike generic phishing, targeted attacks require research and personalization.",
            answers: [
                { text: "Generic phishing.", correct: false },
                { text: "Targeted phishing, also known as spear phishing, focuses on a particular organization, its employees, or industry. Attackers customize messages to increase success rates.", correct: true },
                { text: "Mass phishing.", correct: false },
            ]
        },
        {
            question: "Which type of phishing attack involves fraudulent phone calls?",
            hint: "Consider the communication channel used in vishing.",
            explanation: "Vishing relies on voice communication to deceive victims.",
            answers: [
                { text: "SMS phishing.", correct: false },
                { text: "Vishing (voice phishing) occurs over the phone. Attackers impersonate legitimate entities, aiming to extract sensitive information from victims.", correct: true },
                { text: "Email phishing.", correct: false },
            ]
        },
        {
            question: "What is the purpose of a phishing landing page?",
            hint: "Focus on the deceptive nature of landing pages.",
            explanation: "Landing pages are the final destination where victims unwittingly provide information.",
            answers: [
                { text: "To educate users about cybersecurity.", correct: false },
                { text: "To redirect users to legitimate websites.", correct: true },
                { text: "Phishing landing pages mimic legitimate sites to collect user credentials or other sensitive data. Victims unknowingly interact with these fake pages.", correct: true },
            ]
        },
        {
            question: "What is the key difference between phishing and pharming?",
            hint: "Think about the underlying mechanism in pharming.",
            explanation: "Pharming alters the domain resolution process.",
            answers: [
                { text: "Phishing uses malicious attachments.", correct: false },
                { text: "Phishing involves deceptive emails or messages, while pharming manipulates DNS settings to redirect users to malicious websites without their knowledge.", correct: true },
                { text: " Pharming relies on social engineering.", correct: false },
            ]
        }
    ];

    function showAlert(title, message) {
        document.getElementById('popup-title').textContent = title;
        document.getElementById('popup-message').textContent = message;
        document.getElementById('popup').style.display = 'block';
    }

    document.getElementById('popup-close').addEventListener('click', function() {
        document.getElementById('popup').style.display = 'none';
        currentQuestionIndex++;
        if (currentQuestionIndex < questions.length) {
            showQuestion(shuffledQuestions[currentQuestionIndex]);
        } else {
            document.getElementById('score').value = score;
            document.getElementById('gameForm').submit();
        }
    });

    function shuffle(array) {
        var currentIndex = array.length, temporaryValue, randomIndex;

        // While there remain elements to shuffle...
        while (0 !== currentIndex) {

            // Pick a remaining element...
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex -= 1;

            // And swap it with the current element.
            temporaryValue = array[currentIndex];
            array[currentIndex] = array[randomIndex];
            array[randomIndex] = temporaryValue;
        }

        return array;
    }

    // Shuffle the questions
    let shuffledQuestions = shuffle(questions);

    let currentQuestionIndex = 0;
    let score = 0;


    function showQuestion(question) {
        const questionContainer = document.getElementById('question-container');
        questionContainer.innerHTML = `
            <div>
                <p>${question.question}</p>
                ${question.answers.map((answer, index) => `
                    <label>
                        <input type="radio" name="answer" value="${index}">
                        ${answer.text}
                    </label>
                `).join('')}
            </div>
        `;
    }

    document.getElementById('gameForm').addEventListener('submit', (event) => {
        event.preventDefault();
        const selectedAnswerIndex = document.querySelector('input[name="answer"]:checked').value;
        if (questions[currentQuestionIndex].answers[selectedAnswerIndex].correct) {
            score += 10;
            showAlert("Correct Hoe!" + questions[currentQuestionIndex].explanation);
        } else {
            showAlert("Wrong hoe, dumb bitch!" + questions[currentQuestionIndex].hint);
        }        
    });

    showQuestion(shuffledQuestions[currentQuestionIndex]);
</script>
{% endblock %}
